---
published: true
title: CSRF与XSS简介
tags: security web 中文
---
# 前言
CSRF和XSS是两种较为常见的Web攻击方式。他们的共同之处在于都利用了HTML中可以用&lt;script&gt;&lt;/script&gt;执行javascript语句的特性，通过改写浏览器中运行的HTML来植入恶意的script，从而达到攻击的目的。

二者的一大区别在于CSRF是**攻击者伪装成受害者向服务器发出请求**，而XSS则是**攻击者向服务器给受害者的信息中注入script**。

在由CWE选出的[2022年危险软件漏洞Top25](https://cwe.mitre.org/top25/archive/2022/2022_cwe_top25.html)中，XSS与CSRF分别位列第二、第九位，足以见得二者在Web安全领域的重要性。

![cwe top25](../images/posts/2023-02-24-CSRF与XSS简介/cwe25.png)

本文将分别对CSRF和XSS进行简单介绍，并给出一些基础的攻击思路以及防御的方法。
# CSRF
## 何为CSRF？
CSRF全称为Cross-Site Request Forgery，中文译为“跨站请求伪造”。字面上理解就是受害者原本正在访问（或最近登录过）合法的网站A，却突然被攻击者诱骗去访问了恶意网站B，而网站B会迫使受害者的浏览器向网站A发出请求，这样就达到了假扮受害者在网站A上进行操作的效果，例如假若A是银行网站，则攻击者可以代表受害者进行转账。

注意以上过程中，先决条件是**受害者正在访问或最近登录过合法网站A**，这是由于CSRF攻击的基础是**网站A会接受受害者浏览器的请求**，而这样的基础显然需要受害者已经登录了网站或网站“记住”了受害者的登录信息。CSRF正是利用了网站A对受害者的信任来假造恶意的请求。

我猜测你的心中现在有三个问题：（1）攻击者怎么让受害者访问恶意网站B？（2）什么叫“网站记住了受害者的登录信息”？（3）恶意网站B如何迫使受害者浏览器向网站A发出请求？

对于（1）（3）两个问题，我将在下文中详细解答，这里先对（2）进行回答。“网站记住了受害者的登录信息”，这个过程涉及的概念叫做**cookie**。

那么什么是cookie呢？当我们平常登录一个网站时，出于安全考虑，除了账号密码外，网站通常要求我们进行额外的验证，例如发短信、发邮件、机器人检测等。这样的登录方式虽然更安全，但同时也更繁琐。于是为了省去用户访问网站时登录的繁琐步骤，网站选择**在一段时间内记住**用户的登录信息，在用户第一次登录后，网站会传给用户一个**凭证**让用户的浏览器保存，之后每次用户访问该网站时，浏览器会自动将凭证一起传给网站服务器，服务器验证凭证后便不再需要用户自己进行登录了。这个由网站生成，由用户浏览器储存的**凭证**就是**cookie**。cookie除了用于登录凭证外，还可以用于记录用户的偏好设置，例如你在访问某网页时选择dark mode，网站服务器便会生成一个对应cookie给你的浏览器，于是以后再访问时服务器就知道你想用dark mode，可以自动为你设置。cookie的操作过程非常简单，当浏览器浏览网页时，会给网站服务器发送request，服务器则会回传response给浏览器，只需要在response中加入set_cookie的指令，就可以命令浏览器存储cookie，浏览器在之后访问该网站时会**自动**把它储存所有与该网站相关的cookie写在request中发给服务器。

CSRF利用的便是**浏览器自动发送cookie**的特点，在用户登录网站并获取cookie后，即便攻击者不知道用户的用户名、密码，仍然能够以诱导浏览器发送request的方式借助cookie来假扮用户。